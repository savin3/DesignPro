{% extends 'catalog/base_template.html' %}
{% block title %} Редактирование заявки {% endblock %}
{% block content %}

    <div style="margin-bottom: 30px;">
        <h3>Текущая информация:</h3>
        <p><strong>Название:</strong> {{ changeable_request.title }}</p>
        <p><strong>Описание:</strong> {{ changeable_request.description }}</p>
        <p><strong>Текущая категория:</strong> {{ changeable_request.category }}</p>
        <p><strong>Текущий статус:</strong> {{ changeable_request.status }}</p>
        {% if changeable_request.image %}
            <p><strong>Изображение:</strong></p>
            <img src="{{ changeable_request.image.url }}" alt="Изображение заявки" style="height: 200px; width: 200px">
        {% endif %}
    </div>

    <div style="display: flex; gap: 50px;">
        <div style="border: 1px solid; padding: 20px; border-radius: 5px;">
            <h3>Изменить статус</h3>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                {% if error %}
                    <div style="color: red; margin-bottom: 20px;">
                        {{ error }}
                    </div>
                {% endif %}
                <div>
                    {%if changeable_request.status.name == "New"%}
                        <div>
                            {{form.worker_comment.label_tag}}
                            <input type="text" name="worker_comment" required> <!--Устанавливаем полю для ввода комментария дизайнера обязательность-->
                        </div>
                        <div>
                            {{form.completed_image.label_tag}}
                            <input type="file" name="completed_image" accept="completed_image/*">
                            {{form.completed_image.help_text}}
                        </div>
                        <button type="submit" name="edit_status_to_in_work">Изменить на in_work</button>
                    {%else%}
                        <button type="submit" disabled>Изменить на in_work</button>
                    {% endif %}
                </div>
            </form>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                {% if error %}
                    <div style="color: red; margin-bottom: 20px;">
                        {{ error }}
                    </div>
                {% endif %}
                <div>
                    {%if changeable_request.status.name == "New"%}
                        <div>
                            {{form.worker_comment.label_tag}}
                            <input type="text" name="worker_comment">
                        </div>
                        <div>
                            {{form.completed_image.label_tag}}
                            <input type="file" name="completed_image" accept="completed_image/*" required> <!--Устанавливаем полю для ввода изображения обязательность-->
                            {{form.completed_image.help_text}}
                        </div>
                        <button type="submit" name="edit_status_to_done">Изменить на done</button>
                    {%else%}
                        <button type="submit" disabled>Изменить на done</button>
                    {% endif %}
                </div>
            </form>

        </div>

        <div style="border: 1px solid; padding: 20px; border-radius: 5px;">
            <h3>Изменить категорию</h3>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="category">Категории:</label>
                    <select id="category" name="category" style="margin: 10px 0; padding: 5px;">
                        {% for category in list_categories %}
                            <option value="{{ category.id }}" {% if category.id == changeable_request.category.id %}selected{% endif %}> <!--Если категория из списка_категорий, находит пару тут, то мы делаем ее выбранной-->
                                {{ category }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" name="edit_category" style="padding: 8px 16px; border: none; border-radius: 4px;">
                    Изменить категорию
                </button>
            </form>
        </div>
    </div>
{%endblock%}